<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="longevity, Scala, NoSQL, MongoDB, Cassandra, database, Domain Driven Design" />
    <meta name="description" content="A Persistence Framework for Scala and NoSQL" />

    <meta property="og:title" content="longevity"/>
    <meta property="og:description" content="A Persistence Framework for Scala and NoSQL"/>
    <meta property="og:image" content="http://longevityframework.org/images/longevity.png" />
    <meta property='og:url' content="http://longevityframework.org/" />

    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/stylesheets/longevity.css">
    <link rel="stylesheet" href="/stylesheets/stylesheet.css">
    <link rel="stylesheet" href="/stylesheets/github-light.css">
    <link rel="stylesheet" href="/stylesheets/print.css" media="print">
    <link rel="stylesheet" href="/stylesheets/emacs.css">

    <link rel="icon" type="image/png" href="http://longevityframework.org/favicon.png" >

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
      Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-42481814-3', 'auto');
      ga('send', 'pageview');
    </script>

    
    <title>key values</title>
    
  </head>

  <body>
    <header>
      <div class="inner">
        <h1><a href="/" class="nostyle">longevity</a></h1>
        <h2>
          A Persistence Framework for Scala and NoSQL
        </h2>
        <a href="https://github.com/longevityframework/longevity" class="button">
          <small>View project on</small> GitHub
        </a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          
          <h1> key values </h1>
          
          <p>Key values are used to uniquely identify a <a href="persistents.html">persistent
object</a>. They can be embedded in persistents in two
different ways. The first way to embed a key value is as a unique
identifier for the persistent in question. For example, we may want to
stipulate that every <code class="highlighter-rouge">User</code> has a unique <code class="highlighter-rouge">Username</code>. We can model this
in longevity like so:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">longevity.model.annotations.keyVal</span>
<span class="k">import</span> <span class="nn">longevity.model.annotations.persistent</span>

<span class="nd">@keyVal</span><span class="o">[</span><span class="kt">DomainModel</span>, <span class="kt">User</span><span class="o">]</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Username</span><span class="o">(</span><span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="nd">@persistent</span><span class="o">[</span><span class="kt">DomainModel</span><span class="o">]</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span>
  <span class="n">username</span><span class="k">:</span> <span class="kt">Username</span><span class="o">,</span>
  <span class="n">firstName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">lastName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">usernameKey</span> <span class="k">=</span> <span class="n">key</span><span class="o">(</span><span class="n">props</span><span class="o">.</span><span class="n">username</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<p>As with persistents and components, you need to declare your key values in the same package or a
subpackage of the package where you model is declared.</p>

<p>The <code class="highlighter-rouge">implicit val usernameKey</code> defines the <a href="../ptype/keys.html">key</a> for our key value type <code class="highlighter-rouge">Username</code>.
As you can see, this makes use of the <code class="highlighter-rouge">object props</code> embedded in <code class="highlighter-rouge">object User</code> that we saw towards
the bottom of the <a href="persistents.html">chapter on persistents</a>. Without the <code class="highlighter-rouge">@persistent</code> annotation
on the case class, this wouldn’t compile at all. But if we recall how this annotation expands, we
see if makes sense. The <code class="highlighter-rouge">props.username</code> is put in by the <code class="highlighter-rouge">@mprops</code> annotation, and the method <code class="highlighter-rouge">key</code>
comes from the fact that <code class="highlighter-rouge">object User</code> has become a <code class="highlighter-rouge">PType</code> (<a href="../../api/longevity/model/PType.html#key[V](keyValProp:longevity.model.ptype.Prop[P,V])(implicitevidence$4:longevity.model.KVEv[M,P,V]):longevity.model.ptype.Key[M,P,V]">scaladoc here</a>).</p>

<p>We’ll talk more about keys in a <a href="../ptype/keys.html">later section</a>.</p>

<p>The second way we can embed a <code class="highlighter-rouge">KeyVal</code> in a persistent object is as a reference to some other
persistent object. As an example, let’s suppose that the users in our domain have an optional
sponsor. We can specify the sponsor by providing the sponsor’s username, like so:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">longevity.model.annotations.keyVal</span>
<span class="k">import</span> <span class="nn">longevity.model.annotations.persistent</span>

<span class="nd">@keyVal</span><span class="o">[</span><span class="kt">DomainModel</span>, <span class="kt">User</span><span class="o">]</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Username</span><span class="o">(</span><span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="nd">@persistent</span><span class="o">[</span><span class="kt">DomainModel</span><span class="o">]</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">User</span><span class="o">(</span>
  <span class="n">username</span><span class="k">:</span> <span class="kt">Username</span><span class="o">,</span>
  <span class="n">firstName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">lastName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">sponsor</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Username</span><span class="o">])</span>

<span class="k">object</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">usernameKey</span> <span class="k">=</span> <span class="n">key</span><span class="o">(</span><span class="n">props</span><span class="o">.</span><span class="n">username</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<p>This <code class="highlighter-rouge">sponsor</code> field represents a relationship between two persistent objects. In UML, we call this
kind of relationship an
<a href="http://aviadezra.blogspot.com/2009/05/uml-association-aggregation-composition.html">aggregation</a>.
With aggregations, the life cycles of the entities in question are independent.</p>

<p>As we can see in the previous example, key values can appear inside <a href="collections.html">collections</a>.
They can also have multiple fields, and appear within <a href="components.html">components</a>. But they
currently cannot contain any collections or <a href="../poly">polymorphic objects</a>.</p>

<p>We can always look up a persistent object by key value using <a href="../repo/retrieve.html">repository method
<code class="highlighter-rouge">Repo.retrieve</code></a>, as we will discuss in a later section.</p>

<p>The non-annotation equivalent for the key value looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">longevity.model.KVType</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Username</span><span class="o">(</span><span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Username</span> <span class="k">extends</span> <span class="nc">KVType</span><span class="o">[</span><span class="kt">DomainModel</span>, <span class="kt">User</span>, <span class="kt">Username</span><span class="o">]</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">KVType[DomainModel, User, Username]</code> contains an implicit <code class="highlighter-rouge">KVEv[DomainModel, User, Username]</code>,
which gives us compile-time assurance that the key value supplied to <code class="highlighter-rouge">Repo.retrieve</code> is a valid key
value in the model.</p>

<div style="display: flex;
            justify-content: space-between;
            text-align: center;
            margin-left: 3em;
            margin-right: 3em;">

<div style="min-width: 10em">

  prev: <a href="components.html">components</a>

</div>

<div style="min-width: 10em">

up: <a href=".">the domain model</a>

</div>

<div style="min-width: 10em">

next: <a href="limitations.html">limitations on persistents, components, and key values</a>

</div>

</div>


        </section>

        <aside id="sidebar">
          <a href="/feature-list.html"                                      class="button">Feature List    </a>
          <a href="/getting-started"                                        class="button">Getting Started </a>
          <a href="/manual"                                                 class="button">User Manual     </a>
          <a href="/api/longevity"                                          class="button">Scaladocs       </a>
          <a href="https://groups.google.com/forum/#!forum/longevity-users" class="button">Discussion Forum</a>
          <a href="/resources.html"                                         class="button">Resources       </a>
        </aside>
      </div>
    </div>
  
  </body>
</html>
